{:assets        [{:url "/raw/audio/l2/a10/L2_A10_Mari.m4a" :type "audio"}

                 {:url "/raw/img/stadium/volleyball/background.jpg", :size 10 :type "image"}
                 {:url "/raw/img/stadium/volleyball/ball.png", :size 1 :type "image"}
                 {:url "/raw/audio/l2/mari-chants.m4a", :size 5, :type "audio" :alias "mari chants"}
],
 :templates ["coaching"]
 :objects       {:background {:type "background", :src "/raw/img/stadium/volleyball/background.jpg"},
                 :vera       {:type       "animation" :x 1182 :y 1010 :name "vera-45" :anim "volley_idle" :speed 0.3
                              :width      758 :height 1130 :scale {:x 0.25 :y 0.25} :start true
                              :scene-name "vera" :skin "vera"}

                 :boy1       {:type       "animation" :x 1556 :y 871 :name "vera-45" :anim "idle" :speed 0.3
                              :width      758 :height 1130 :scale {:x 0.25 :y 0.25} :start true
                              :scene-name "boy1" :skin "1_boy"}

                 :girl2      {:type       "animation" :x 197 :y 1010 :name "vera-45" :anim "idle" :speed 0.3
                              :width      758 :height 1130 :scale {:x -0.25 :y 0.25} :start true
                              :scene-name "girl2" :skin "2_girl"}

                 :girl3      {:type       "animation" :x 512 :y 871 :name "vera-45" :anim "idle" :speed 0.3
                              :width      758 :height 1130 :scale {:x -0.25 :y 0.25} :start true
                              :scene-name "girl3" :skin "3_girl"}

                 :mari       {:type    "animation" :scene-name "mari" :name "mari" :anim "idle"
                              :start   true :speed 0.35 :transition "mari"
                              :x       1265 :y 311 :width 473 :height 511 :anim-offset {:x 0 :y -150}
                              :scale-y 0.5 :scale-x 0.5}

                 :display    {:type        "animation"
                              :name        "boxes"
                              :anim        "idle_fly2"
                              :speed       0.3
                              :loop        true
                              :start       true
                              :x           1085
                              :y           470
                              :width       771
                              :height      1033
                              :origin      {:type "center-center"}
                              :skin        "empty"
                              :scene-name  "display"
                              :scale       {:x 0.3 :y 0.3}
                              :anim-offset {:x 0 :y -300}}

                 :box1       {:type       "animation" :x 1304 :y 831 :width 771 :height 1033 :origin {:type "center-center"} :skin "empty"
                              :scene-name "box1" :name "boxes" :anim "idle1" :scale {:x 0.3 :y 0.3} :anim-offset {:x 0 :y -300}
                              :actions    {:click {:type "action", :id "check-concept" :params {:player "player1"}, :on "click"}}}

                 :letter1    {:type           "text"
                              :text           ""
                              :x              1100
                              :y              485
                              :width          200
                              :height         200
                              :align          "center"
                              :vertical-align "middle"
                              :font-family    "Lexend Deca"
                              :font-size      120
                              :shadow-color   "#1a1a1a"
                              :shadow-offset  {:x 2 :y 2}
                              :shadow-blur    2
                              :shadow-opacity 0.5
                              :fill           "#d25523"
                              :actions        {:click {:type "action", :id "check-concept" :params {:player "player1"}, :on "click"}}}

                 :box2       {:type       "animation" :x 1665 :y 666 :width 771 :height 1033 :origin {:type "center-center"} :skin "empty"
                              :scene-name "box2" :name "boxes" :anim "idle1" :scale {:x 0.3 :y 0.3} :anim-offset {:x 0 :y -300}
                              :actions    {:click {:type "action", :id "check-concept" :params {:player "player2"}, :on "click"}}}

                 :letter2    {:type           "text"
                              :text           ""
                              :x              1461
                              :y              320
                              :width          200
                              :height         200
                              :align          "center"
                              :vertical-align "middle"
                              :font-family    "Lexend Deca"
                              :font-size      120
                              :shadow-color   "#1a1a1a"
                              :shadow-offset  {:x 2 :y 2}
                              :shadow-blur    2
                              :shadow-opacity 0.5
                              :fill           "#d25523"
                              :actions        {:click {:type "action", :id "check-concept" :params {:player "player2"}, :on "click"}}}

                 :box3       {:type       "animation" :x 309 :y 831 :width 771 :height 1033 :origin {:type "center-center"} :skin "empty"
                              :scene-name "box3" :name "boxes" :anim "idle1" :scale {:x 0.3 :y 0.3} :anim-offset {:x 0 :y -300}
                              :actions    {:click {:type "action", :id "check-concept" :params {:player "player3"}, :on "click"}}}

                 :letter3    {:type           "text"
                              :text           ""
                              :x              105
                              :y              485
                              :width          200
                              :height         200
                              :align          "center"
                              :vertical-align "middle"
                              :font-family    "Lexend Deca"
                              :font-size      120
                              :shadow-color   "#1a1a1a"
                              :shadow-offset  {:x 2 :y 2}
                              :shadow-blur    2
                              :shadow-opacity 0.5
                              :fill           "#d25523"
                              :actions        {:click {:type "action", :id "check-concept" :params {:player "player3"}, :on "click"}}}

                 :box4       {:type       "animation" :x 629 :y 666 :width 771 :height 1033 :origin {:type "center-center"} :skin "empty"
                              :scene-name "box4" :name "boxes" :anim "idle1" :scale {:x 0.3 :y 0.3} :anim-offset {:x 0 :y -300}
                              :actions    {:click {:type "action", :id "check-concept" :params {:player "player4"}, :on "click"}}}

                 :letter4    {:type           "text"
                              :text           ""
                              :x              425
                              :y              320
                              :width          200
                              :height         200
                              :align          "center"
                              :vertical-align "middle"
                              :font-family    "Lexend Deca"
                              :font-size      120
                              :shadow-color   "#1a1a1a"
                              :shadow-offset  {:x 2 :y 2}
                              :shadow-blur    2
                              :shadow-opacity 0.5
                              :fill           "#d25523"
                              :actions        {:click {:type "action", :id "check-concept" :params {:player "player4"}, :on "click"}}}

                 :ball       {:type     "group" :x 1163 :y 941 :width 126 :height 126
                              :children ["ball-image"] :transition "ball-transition"}

                 :ball-image {:type    "transparent" :width 126 :height 126 :origin {:type "center-center"}
                              :scale-x 0.5 :scale-y 0.5
                              :states  {:hidden  {:type "transparent"}
                                        :visible {:type "image" :src "/raw/img/stadium/volleyball/ball.png"}}}},
 :scene-objects [["background"]
                 ["vera" "boy1" "girl2" "girl3"]
                 ["box1" "letter1" "box2" "letter2" "box3" "letter3" "box4" "letter4"]
                 ["display" "mari" "ball"]],
 :actions       {:start-activity          {:type "start-activity" :id "volleyball-letters"}
                 :stop-activity           {:type "stop-activity" :id "volleyball-letters"}
                 :finish-activity         {:type "sequence-data"
                                           :data [{:type "finish-activity" :id "volleyball-letters"}
                                                  {:type "scene" :scene-id "stadium"}]}

                 :start                   {:type "sequence"
                                           :data ["start-activity"
                                                  "init-slots"
                                                  "init-first-player"
                                                  "init-audio-correct"
                                                  "init-audio-try-again"
                                                  "renew-words"
                                                  "renew-pairs"
                                                  "renew-current-concept"
                                                  "mari-welcome-audio"
                                                  "voice-high-var"]}

                 :init-slots              {:type "parallel"
                                           :data [{:type "set-variable" :var-name "slot1" :var-value "player1"}
                                                  {:type "set-variable" :var-name "slot2" :var-value "player2"}
                                                  {:type "set-variable" :var-name "slot3" :var-value "player3"}
                                                  {:type "set-variable" :var-name "slot4" :var-value "player4"}]}

                 :init-first-player       {:type "set-variable" :var-name "current-player" :var-value "player1"}

                 :renew-words             {:type        "lesson-var-provider"
                                           :provider-id "words-set"
                                           :variables   ["item-1" "item-2" "item-3" "item-4" "item-5"
                                                         "item-6" "item-7" "item-8" "item-9" "item-10"]
                                           :shuffled    true
                                           :limit       3
                                           :repeat      4
                                           :from        "concepts-group"}

                 :renew-pairs             {:type        "lesson-var-provider"
                                           :provider-id "pairs-set"
                                           :variables   ["pair-1" "pair-2" "pair-3" "pair-4" "pair-5"
                                                         "pair-6" "pair-7" "pair-8" "pair-9" "pair-10"]
                                           :shuffled    true
                                           :from        "concepts-all"}

                 :renew-current-concept   {:type "sequence-data"
                                           :data [{:type        "vars-var-provider"
                                                   :provider-id "current-concept"
                                                   :variables   ["current-concept"]
                                                   :from        ["item-1" "item-2" "item-3" "item-4" "item-5"
                                                                 "item-6" "item-7" "item-8" "item-9" "item-10"]
                                                   :shuffled    true
                                                   :on-end      "finish-activity"}
                                                  {:type      "vars-var-provider"
                                                   :variables ["pair-concept-1" "pair-concept-2" "pair-concept-3"]
                                                   :from      ["pair-1" "pair-2" "pair-3" "pair-4" "pair-5"
                                                               "pair-6" "pair-7" "pair-8" "pair-9" "pair-10"]
                                                   :shuffled  true
                                                   :unique    true
                                                   :from-var  [{:var-name "current-concept" :var-property "concept-name"
                                                                :var-key  "concept-name" :action-property "exclude-property-values"}]}
                                                  {:type "sequence-data"
                                                   :data [{:type      "vars-var-provider"
                                                           :variables ["current-target"]
                                                           :from      ["slot1" "slot2" "slot3" "slot4"]
                                                           :shuffled  true
                                                           :from-var  [{:var-name "current-player" :action-property "exclude-values" :to-vector true}]}
                                                          {:type      "vars-var-provider"
                                                           :variables ["pair-target-1" "pair-target-2" "pair-target-3"]
                                                           :from      ["slot1" "slot2" "slot3" "slot4"]
                                                           :shuffled  true
                                                           :unique    true
                                                           :from-var  [{:var-name "current-target" :action-property "exclude-values" :to-vector true}]}
                                                          {:type     "set-current-concept"
                                                           :from-var [{:var-name "current-concept" :action-property "value" :var-property "concept-name"}]}]}
                                                  {:type "sequence-data"
                                                   :data [{:type "set-slot" :target "display" :slot-name "box1" :attachment {:scale-x 4 :scale-y 4 :x 40}
                                                           :from-var [{:var-name "current-concept" :action-property "image" :var-property "image-src"}]}

                                                          {:type     "map-value" :var-name "target-letter"
                                                           :from     ["player1" "player2" "player3" "player4"]
                                                           :to       ["letter1" "letter2" "letter3" "letter4"]
                                                           :from-var [{:var-name "current-target" :action-property "value"}]}
                                                          {:type     "set-attribute" :attr-name "text"
                                                           :from-var [{:var-name        "target-letter"
                                                                       :action-property "target"}
                                                                      {:var-name        "current-concept" :var-property "letter"
                                                                       :action-property "attr-value"}]}

                                                          {:type     "map-value" :var-name "target-letter"
                                                           :from     ["player1" "player2" "player3" "player4"]
                                                           :to       ["letter1" "letter2" "letter3" "letter4"]
                                                           :from-var [{:var-name "pair-target-1" :action-property "value"}]}
                                                          {:type     "set-attribute" :attr-name "text"
                                                           :from-var [{:var-name        "target-letter"
                                                                       :action-property "target"}
                                                                      {:var-name        "pair-concept-1" :var-property "letter"
                                                                       :action-property "attr-value"}]}

                                                          {:type     "map-value" :var-name "target-letter"
                                                           :from     ["player1" "player2" "player3" "player4"]
                                                           :to       ["letter1" "letter2" "letter3" "letter4"]
                                                           :from-var [{:var-name "pair-target-2" :action-property "value"}]}
                                                          {:type     "set-attribute" :attr-name "text"
                                                           :from-var [{:var-name        "target-letter"
                                                                       :action-property "target"}
                                                                      {:var-name        "pair-concept-2" :var-property "letter"
                                                                       :action-property "attr-value"}]}

                                                          {:type     "map-value" :var-name "target-letter"
                                                           :from     ["player1" "player2" "player3" "player4"]
                                                           :to       ["letter1" "letter2" "letter3" "letter4"]
                                                           :from-var [{:var-name "pair-target-3" :action-property "value"}]}
                                                          {:type     "set-attribute" :attr-name "text"
                                                           :from-var [{:var-name        "target-letter"
                                                                       :action-property "target"}
                                                                      {:var-name        "pair-concept-3" :var-property "letter"
                                                                       :action-property "attr-value"}]}]}]}

                 :check-concept           {:type        "test-var-scalar"
                                           :var-name    "current-target"
                                           :success     "pick-correct"
                                           :fail        "pick-wrong"
                                           :from-params [{:action-property "value" :param-property "player"}]}

                 :pick-correct            {:type "parallel"
                                           :data [{:type "action" :id "mari-correct"}
                                                  {:type     "pick-correct" :activity "volleyball"
                                                   :from-var [{:var-name "current-concept" :action-property "concept-name" :var-property "concept-name"}]}
                                                  {:type "action" :id "throw"}]}

                 :pick-wrong              {:type "sequence-data"
                                           :data [{:type "action" :id "mari-wrong"}
                                                  {:type        "copy-variable" :var-name "picked"
                                                   :from-params [{:action-property "from" :param-property "player"}]}
                                                  {:type     "pick-wrong" :activity "volleyball"
                                                   :from-var [{:var-name "current-concept" :action-property "concept-name" :var-property "concept-name"}
                                                              {:var-name "picked" :action-property "option"}]}]}

                 :throw                   {:type "sequence-data"
                                           :data [{:type     "action"
                                                   :from-var [{:template "animate-throw-%" :action-property "id" :var-name "current-player"}]}
                                                  {:type "state" :target "ball-image" :id "visible"}
                                                  {:type "empty" :duration 200}
                                                  {:type "parallel"
                                                   :data [{:type "sequence-data"
                                                           :data [{:type     "action"
                                                                   :from-var [{:template "throw-from-%" :action-property "id" :var-name "current-player"}]}
                                                                  {:type "state" :target "ball-image" :id "hidden"}]}
                                                          {:type "sequence-data"
                                                           :data [{:type "empty" :duration 700}
                                                                  {:type "action" :from-params [{:template "animate-catch-%" :action-property "id" :param-property "player"}]}]}]}
                                                  {:type        "set-variable" :var-name "current-player"
                                                   :from-params [{:action-property "var-value" :param-property "player"}]}
                                                  {:type "action" :id "renew-current-concept"}
                                                  {:type "action" :id "voice-high-var"}]}

                 :throw-from-player1      {:type "action" :from-params [{:template "throw-player1-%" :action-property "id" :param-property "player"}]}
                 :throw-from-player2      {:type "action" :from-params [{:template "throw-player2-%" :action-property "id" :param-property "player"}]}
                 :throw-from-player3      {:type "action" :from-params [{:template "throw-player3-%" :action-property "id" :param-property "player"}]}
                 :throw-from-player4      {:type "action" :from-params [{:template "throw-player4-%" :action-property "id" :param-property "player"}]}

                 :throw-player1-player2   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1272 :y 487} {:x 1376 :y 451} {:x 1538 :y 801}] :duration 1.4}}
                 :throw-player1-player3   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1066 :y 284} {:x 960 :y 253} {:x 213 :y 940}] :duration 1.4}}
                 :throw-player1-player4   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1066 :y 284} {:x 960 :y 253} {:x 528 :y 799}] :duration 1.4}}

                 :throw-player2-player1   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1472 :y 487} {:x 1376 :y 451} {:x 1163 :y 941}] :duration 1.4}}
                 :throw-player2-player3   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1066 :y 284} {:x 960 :y 253} {:x 213 :y 940}] :duration 1.4}}
                 :throw-player2-player4   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 1066 :y 284} {:x 960 :y 253} {:x 528 :y 799}] :duration 1.4}}

                 :throw-player3-player1   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 866 :y 284} {:x 960 :y 253} {:x 1163 :y 941}] :duration 1.4}}
                 :throw-player3-player2   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 866 :y 284} {:x 960 :y 253} {:x 1538 :y 801}] :duration 1.4}}
                 :throw-player3-player4   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 246 :y 551} {:x 346 :y 451} {:x 528 :y 799}] :duration 1.4}}

                 :throw-player4-player1   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 866 :y 284} {:x 960 :y 253} {:x 1163 :y 941}] :duration 1.4}}
                 :throw-player4-player2   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 866 :y 284} {:x 960 :y 253} {:x 1538 :y 801}] :duration 1.4}}
                 :throw-player4-player3   {:type "transition" :transition-id "ball-transition" :to {:bezier [{:x 446 :y 551} {:x 346 :y 451} {:x 213 :y 940}] :duration 1.4}}

                 :animate-throw-player1   {:type "sequence-data"
                                           :data [{:type "animation" :target "vera" :id "volley_throw"}
                                                  {:type "add-animation" :target "vera" :id "idle" :loop true}]}

                 :animate-throw-player2   {:type "sequence-data"
                                           :data [{:type "animation" :target "boy1" :id "volley_throw"}
                                                  {:type "add-animation" :target "boy1" :id "idle" :loop true}]}

                 :animate-throw-player3   {:type "sequence-data"
                                           :data [{:type "animation" :target "girl2" :id "volley_throw"}
                                                  {:type "add-animation" :target "girl2" :id "idle" :loop true}]}

                 :animate-throw-player4   {:type "sequence-data"
                                           :data [{:type "animation" :target "girl3" :id "volley_throw"}
                                                  {:type "add-animation" :target "girl3" :id "idle" :loop true}]}

                 :animate-catch-player1   {:type "sequence-data"
                                           :data [{:type "animation" :target "vera" :id "volley_call"}
                                                  {:type "add-animation" :target "vera" :id "volley_idle" :loop true}]}

                 :animate-catch-player2   {:type "sequence-data"
                                           :data [{:type "animation" :target "boy1" :id "volley_call"}
                                                  {:type "add-animation" :target "boy1" :id "volley_idle" :loop true}]}

                 :animate-catch-player3   {:type "sequence-data"
                                           :data [{:type "animation" :target "girl2" :id "volley_call"}
                                                  {:type "add-animation" :target "girl2" :id "volley_idle" :loop true}]}

                 :animate-catch-player4   {:type "sequence-data"
                                           :data [{:type "animation" :target "girl3" :id "volley_call"}
                                                  {:type "add-animation" :target "girl3" :id "volley_idle" :loop true}]}

                 :wait-for-box-animations {:type "empty" :duration 500}

                 :empty-before-dialog     {:type "empty" :duration 3000}

                 :voice-high-var          {:type     "action"
                                           :from-var [{:var-name     "current-concept"
                                                       :var-property "mari-sound-3"}]}

                 :mari-welcome-audio      {:type     "animation-sequence",
                                           :target   "mari",
                                           :track    1,
                                           :offset   0.180,
                                           :audio    "/raw/audio/l2/a10/L2_A10_Mari.m4a",
                                           :start    0.180,
                                           :duration 12.288,
                                           :data     [{:start 0.564, :end 4.442, :anim "talk"}
                                                      {:start 5.140, :end 6.741, :anim "talk"}
                                                      {:start 7.147, :end 12.175, :anim "talk"}]}

                 }

 :triggers      {:start {:on "start" :action "start"}
                 :back  {:on "back" :action "stop-activity"}}
 :metadata      {:autostart true
                 :prev      "stadium"}}
